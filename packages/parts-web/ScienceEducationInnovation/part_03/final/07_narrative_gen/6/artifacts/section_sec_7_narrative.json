{
  "id": "sec_7",
  "index": 6,
  "title": "关键技术三：低开销日志采集系统",
  "time_range": "00:14:52,165 - 00:16:50,345",
  "script": "20年前可能是一些比较业余的选手，大家很分散，做一些很有趣的攻击。\n好，那么第三个是系统方面的工作。就是我们这个整个系统呢，实际上它还是很贵的。它那么它的系统来自两个方面的挑战，就是说，我需要对你整个系统里边的所有数据采集很多，我要监控你的操作系统运行。\n但是我们这个监控呢，本身又会给这个操作系统本身带来很大的额外开销，\n会带来负担。那我怎么去优化这个负担呢？\n那么我们这里边就做了两个工作，一个是对现有工作的一个软件方面的方法，一个硬件方面的方法。\n那么软件方面的方法实际上是我们是发现现有工作为什么会有很大的负担，是因为他们担心我们攻击者会对我们这个探针进行攻击。\n为了保护这个探针，他们加了很多很多很重的这样一个保护。\n但是我们发现呢，现在这个采集器，它之所以会对系统产生拖慢，是因为它们间接地破坏了这个进程之间的隔离。比如说我这产生的所有日志，我采集过来，这个日志之间采集全部到采集器中间去处理。\n而这个采集器中间它是没有隔离的。\n这样就给了攻击者很多机会来来拖慢我的系统。\n所以呢，我们就提出了这样新的架构，我们在每个进程里边，让他们独立用自己的资源去做隔离，去处理自己产生的日志，防止相互干扰。\n另外一个工作呢，是我们跟硬件相结合，我们去把那个整个监控的负载把它卸载到了这个DPU上，用通过DPU这种强大的这种处理能力来减少我们这个\n开销。那么这里边我们做了一些优化，就把这个怎么样用这个DPU的拉取能力，很快地把这个系统上产生的这些运行日志，几乎用零代价的方法拉取到数据端上。\n然后我们可以看到，我们现在整个监控的开销呢，仍然在3%以内。我们采集的日志量非常非常大，非常非常细，可以说我们把这个操作系统里面每一个系统调用都采集过来了。\n但是我们的开销呢仍然在3%以内。那么和我们现在主流的这些方法比，比如说常用的sysdig比，或者Linux audit的比，我们实际上可以下降一个数量级的这样的开销。",
  "summary": "第三项关键技术是低开销日志采集系统。为解决传统监控方案因保护探针和集中处理而导致的高昂性能开销，我们从软硬件两方面进行优化。软件上，我们提出新的分片式架构，让各进程独立处理自己的日志以实现隔离、防止干扰；硬件上，我们将监控负载卸载到DPU，利用其强大的处理和拉取能力，实现了近乎零代价的日志采集。最终，即使在采集每一个系统调用的情况下，我们的系统开销仍能控制在3%以内，相比主流方案降低了一个数量级。"
}